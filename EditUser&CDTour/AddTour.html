<!DOCTYPE html>
<html lang="en">
<head>
    <title>Add tour</title>
    <link rel="stylesheet" href="style.css">
    <meta charset="utf-8">
    <!--  This file has been downloaded from bootdey.com @bootdey on twitter -->
    <!--  All snippets are MIT license http://bootdey.com/license -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.8/firebase-storage.js"></script>
    <script language="JavaScript" type="text/javascript" src="/js/jquery-ui-personalized-1.5.2.packed.js"></script>
  <script language="JavaScript" type="text/javascript" src="/js/sprinkle.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://kit.fontawesome.com/80c4a48add.js" crossorigin="anonymous"></script>

</head>
<body >
    <div class="container">
        <center>
            <h2 class="mb-2 text-primary">Insert New Tour</h2>
        </center>
        
        <div class="row gutters">
        <div class="col-xl-3 col-lg-3 col-md-12 col-sm-12 col-12">
        <div class="card h-100">
            <div class="card-body">
                <div class="account-settings">
                    <div class="user-profile">
                        <div class="user-avatar">
                            <h5 class="user-name">Please input tour's image</h5>
                            <input type="file" id ="imgInp"  accept="image/png, image/jpeg">
                            <img  id="blah" src="#" >
                        </div>
                        
                    </div>
                    <div class="about">
                            <p></p>
                    </div>
                </div>
            </div>
        </div>
        </div>
        <div class="col-xl-9 col-lg-9 col-md-12 col-sm-12 col-12">
        <div class="card h-100">
            <div class="card-body">
                <div class="row gutters">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                        <h6 class="mb-2 text-primary">Tour Information</h6>
                    </div>
                    <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                        <div class="form-group">
                            <label for="username">Tour's name</label>
                            <input type="text" class="form-control" id="tourname" placeholder="Enter tourname">
                        </div>
                    </div>
                    <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                        <div class="form-group">
                            <label for="email">Country</label>
                            <input type="email" class="form-control" id="country" placeholder="Enter country">
                        </div>
                       
                    </div>
                    <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                        <div class="form-group">
                            <label for="username">Brief</label>
                        
                            <textarea class="form-control" name="brief" id="brief" cols="20" rows="8" placeholder="Enter brief"></textarea>
                        </div>
                    </div>
                    <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                        <div class="form-group">
                            <label for="phone">Description</label>
                            <textarea class="form-control" name="description" id="description" cols="30" rows="10" placeholder="Enter description"></textarea>
                            <button id="start-button" class="button-xl start-button" title="Start Transcription" style=" font-size: 25px; padding: 8px; border-radius: 10px;"><i class="fa fa-microphone"></i>Start
                            </button>
                            <button id="stop-button" class="button-xl stop-button" title="Stop Transcription" style=" font-size: 25px; padding: 8px; border-radius: 10px;" disabled="true"><i class="fa fa-stop-circle"></i>Stop
                            </button>
                        </div>
                    </div>
                    <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                        <div class="form-group">
                            <label for="email">Guide id</label>
                            <input type="text" class="form-control" id="guideid" placeholder="Enter guide id">
                            <img  id ="imagetourguide"width="120" height="120"  >
                            <button type="button" id="checkid" name="submit" class="btn btn-primary" onclick="checkGID()">CheckGuideId</button>
                        </div>
                    </div>
                    <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                        <div class="form-group">
                            <label for="email">Max member</label>
                            <input type="text" class="form-control" id="maxmember" placeholder="Enter max of member">
                        </div>
                    </div>
                    <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                        <div class="form-group">
                            <label for="email">Price</label>
                            <input type="text" class="form-control" id="price" placeholder="Enter price">
                        </div>
                    </div>
                    <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                        <div class="form-group">
                            <label for="email">Quality</label>
                            <input type="text" class="form-control" id="quality" placeholder="Enter quality">
                        </div>
                    </div>
                    <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                        <div class="form-group">
                            <label for="email">Time</label>
                            <input type="text" class="form-control" id="time" placeholder="Enter time">
                        </div>
                    </div>
                </div>
                <div class="row gutters">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                        <div class="text-right">
                            <button type="button" id="submit" name="submit" class="btn btn-secondary">Cancel</button>
                            <button type="button" id="insertbutton" name="submit" class="btn btn-primary">Insert</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
        </div>
        </div>
</body>
<script>
   var speechRecognition = window.webkitSpeechRecognition

var recognition = new speechRecognition()

var textbox = $("#description")

var instructions = $("#instructions")

var content = ''

recognition.continuous = true

// recognition is started

recognition.onstart = function() {

 instructions.text("Voice Recognition is On")

}

recognition.onspeechend = function() {

 instructions.text("No Activity")

}

recognition.onerror = function() {

 instruction.text("Try Again")

}

recognition.onresult = function(event) {

 var current = event.resultIndex;

 var transcript = event.results[current][0].transcript



 content += transcript

 textbox.val(content)

}

$("#start-button").click(function(event) {
   $('#stop-button').removeAttr('disabled');
 recognition.start();

})
$("#stop-button").click(function(event) {

recognition.stop();

})
textbox.on('input', function() {

 content = $(this).val()

})
    imgInp.onchange = evt => {
  const [file] = imgInp.files
  if (file) {
    blah.src = URL.createObjectURL(file)
    uploadImage();


  }
}
const firebaseConfig = {
    apiKey: "AIzaSyD1bKJdG28qBAdxpIsYkISyQ_6Dh6MVUx4",
    authDomain: "final-project-cloud-8d2cf.firebaseapp.com",
    projectId: "final-project-cloud-8d2cf",
    storageBucket: "final-project-cloud-8d2cf.appspot.com",
    messagingSenderId: "87150956825",
    appId: "1:87150956825:web:6d735cc4758e3d58867588"
    };
    firebase.initializeApp(firebaseConfig);
    
    function uploadImage() {
      const ref = firebase.storage().ref()
      console.log(document.querySelector('#imgInp'));
      const file = document.querySelector('#imgInp').files[0];
      const metadata = {
        contentType: file.type
      };
      const name = file.name;
      const uploadIMG = ref.child(name).put(file, metadata);
      uploadIMG.then(snapshort => snapshort.ref.getDownloadURL())
              .then(url => {
                console.log(url);
                sessionStorage.setItem("imageTour",url);

              })
              .catch(console.error)}
    
    function checkGID() {
        let id = document.getElementById('guideid').value;
        $.ajax({
         url: ' http://localhost:8080/api/tourguide/get/' +id,
         type: 'GET',
         contentType: 'application/json',
         dataType: 'JSON',
         success: 
         function (response) 
         {
             console.log("Venue Successfully Patched!");
             console.log(response);
            
       
        $('#imagetourguide').attr('src', response.image);
         }
         ,
         error: function (jqXHR) {
             // log the error to the console
            // console.log("The following error occured: " + textStatus, errorThrown);

          alert("TourGuide not found!!")
 
         },
         complete: function () {
             console.log("Venue Patch Ran");
            
       
         }
     })
        
    }
     $('#insertbutton').click(function() {

        insertData();
        

     })
     function insertData(){
        let name =document.getElementById('tourname').value;
        let brief = document.getElementById('brief').value;
        let country = document.getElementById('country').value;
        let description =document.getElementById('description').value;
        let id = document.getElementById('guideid').value;
        let tourguide = {id};
        let maxmember=document.getElementById('maxmember').value;
        let price=document.getElementById('price').value;
        let quality=document.getElementById('quality').value;
        let time =document.getElementById('time').value;
        let image = sessionStorage.getItem("imageTour");
        let action ="Sightseeing";
        var formData = {name,brief,country,description,tourguide,maxmember,price,quality,time,action,image};
        $.ajax({
         url: 'http://localhost:8080/api/tours' ,
         type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(formData),
                dataType: 'JSON',
                success: 
         function (response) 
         {
             console.log("Venue Successfully Patched!");
             console.log(response);
           
             alert("insert thanh cong!");
         }
         ,
         error: function (jqXHR) {
             // log the error to the console
            // console.log("The following error occured: " + textStatus, errorThrown);

             alert("that bai ");
 
         },
         complete: function () {
             console.log("Venue Patch Ran");
             
       
           
         }
     })
       
     }
    
</script>
<script type="module">
    
    </script>
</html>